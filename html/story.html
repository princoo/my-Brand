<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/story.css">
</head>
<body>
    <!-- navbar -->
    <header>
        <h1> <img src="../html/images/moon.png" alt=""  onclick="change()" id="theme"></h1>
        <nav>
            <i class="side fa fa-close" onclick="hidemenu()"></i>
            <ul>
                <li><a href="../index.html">HOME</a></li>
                <li><a href="about.html">ABOUT US</a></li>
                <li><a href="services.html">SERVICES</a></li>
                <li><a href="portfolio.html">PORTFOLIO</a></li>
                <li><a href="blog.html">BLOG</a></li>
                <li><a href="contact.html">CONTACT</a></li>
                <li><a href="login.html">LOGIN</a></li>
            </ul>
        </nav>
        <i class="side fa fa-bars" onclick="showmenu()"></i>
</header>

    <!-- story -->
    <button class="back" id="back"><a href="blog.html"><span>BACK</span></a> </button>

    <div class="story">
        <img src="" alt="" srcset="" class="image" id="image">
        <h3 id="title"></h3>
            <p id="body">Lorem ipsum dolor sit amet consectetur adipisicing elit. Quo omnis maxime laboriosam quidem, minima porro quas doloribus enim reprehenderit. Voluptatum provident, voluptatem aspernatur reiciendis ratione perspiciatis doloremque quas. Neque repudiandae cumque impedit? Atque dolor beatae illum ab optio, recusandae voluptatem totam velit consequuntur magni id in consequatur! Tempora voluptas quis amet, molestiae minus quas expedita eaque quam, ex velit cum. Illo labore animi maxime corporis mollitia quidem earum, delectus expedita tenetur quos doloremque natus. Eaque doloremque iste nostrum vel, accusantium exercitationem doloribus, repudiandae, debitis nam quae nisi suscipit? Blanditiis deleniti itaque numquam aspernatur ullam, mollitia odit saepe. Nam, dolor nihil.</p>
            <div class="footer">
                <i class="fa fa-thumbs-up" aria-hidden="true" onclick="funcLike()"></i>
                <span id="likes"></span>
                <i class="fa fa-thumbs-o-down" aria-hidden="true" onclick="funcDislike()"></i>
                <span id="dislikes"></span>

            </div>
            <form action="" id="form">
                <h3>Leave A Comment</h3>
                <textarea name="" id="comment" cols="30" rows="5"placeholder="COMMENT"></textarea><br>  
                <div class="error" id="error"></div>              
                <button type="submit" id="send">SEND</button>
            </form>
            <div class="low-section" id="comments">
                <h4 id="check"><i class="fa fa-comment" aria-hidden="true"></i>  Comments:</h4>
              
            </div>
            
    </div>
    <div class="loader">
        <div class="loading">
            <p> LOGIN FIRST</p>
            <a href="login.html"><bUtton style="background-color: rgba(206, 110, 20, 0.726);"> LOGIN</bUtton></a>
            <bUtton id="cancel">CANCEL</bUtton>

            <span id="wait"></span>
        </div>
    </div>

    <!-- javasript -->
    <script src="../javascript/runpage.js"></script>
    <script>
const image= document.getElementById("image")
const title = document.getElementById("title");
const body = document.getElementById("body");
const commentSec = document.getElementById("comment");
const send = document.getElementById("send");
const container = document.getElementById("comments")
const check = document.getElementById("check")
const likes= document.getElementById("likes")
const dislikes= document.getElementById("dislikes")
const form= document.getElementById("form");
const err= document.getElementById("error");
const cancel= document.getElementById("cancel");
const loader= document.querySelector(".loader");

form.addEventListener('submit',(e)=>{
    e.preventDefault()
  
})
let parameter= new URLSearchParams(window.location.search)
let id = parameter.get("page")
const a= localStorage.getItem("Blogs")
const b= JSON.parse(a);
const blog= b.filter(blogid => b.indexOf(blogid)==id);
image.src=blog[0].image
title.textContent=blog[0].title;
body.textContent=blog[0].body

// add comment
let comment= localStorage.getItem("Comments");
if(comment==null){
    localStorage.setItem("Comments",JSON.stringify([{blogid:"none",email:"none",comment:"none"}]))
    comment=localStorage.getItem("Comments");
}
const array=JSON.parse(comment)

send.addEventListener('click',(e)=>{
    e.preventDefault();
    if(commentSec.value.trim()==='' || commentSec.value.trim()==null){
        err.innerHTML="Please add comment"
    }
    else{
        err.innerHTML=""
        let user=localStorage.getItem("Active")
    if(user==null){
        loader.style.display="block";
        cancel.addEventListener('click',(e)=>{
            loader.style.display="none"
        })
    }
    else{
    const active=JSON.parse(user);
    const z=active[0].activeuser
    array.push({blogid:id,email:z,comment:commentSec.value})
    localStorage.setItem("Comments",JSON.stringify(array))
    window.location.href=`story.html?page=${id}`
    }
    }
  
})
// read comments
const icon=`<i class="fa fa-user" aria-hidden="true"></i>`;
const result = array.filter(blog => blog.blogid==id);

for (let i = 0; i < result.length; i++) {
const userDiv= document.createElement("div");
const parag1= document.createElement("p");
const parag2= document.createElement("p");
parag1.classList.add("profile");
parag2.classList.add("message")
userDiv.classList.add("user");

parag1.innerHTML = icon + " " + result[i].email;
parag2.innerHTML= result[i].comment;
userDiv.innerHTML= parag1.outerHTML + parag2.outerHTML;
container.appendChild(userDiv)
}

// displaying likes
let display= localStorage.getItem("Likes")

if(display==null){
    localStorage.setItem("Likes",JSON.stringify([{blogid:id,likes:"0",dislikes:"0"}]));
    display=localStorage.getItem("Likes");
}
const content=JSON.parse(display);
const single= content.filter(blog=>blog.blogid==id)
 likes.textContent=single[0].likes;
 dislikes.textContent=single[0].dislikes;
 
// incrementing likes
 function funcLike(){
    let action=localStorage.getItem("Active")
    if(action){
        const record=JSON.parse(action)
        if(record[0].dislikeaction==0){
            if(record[0].likeaction==0){
            let thumbsUp = localStorage.getItem("Likes")
    if (thumbsUp==null){
    localStorage.setItem("Likes",JSON.stringify([{blogid:id,likes:"0",dislikes:"0"}]));
    thumbsUp=localStorage.getItem("Likes");
    }
    let g=JSON.parse(thumbsUp)
    const single=g.filter(blog=>blog.blogid==id)
    if(single.length==0){
        g.push({blogid:id,likes:"0",dislikes:"0"})
        console.log(g)
        localStorage.setItem("Likes",JSON.stringify(g));
    }
    for (let i = 0; i < g.length; i++) {
        if(g[i].blogid==id){
            let h =parseInt(g[i].likes)+1
            let y= parseInt(g[i].dislikes)
            let r=parseInt(record[0].likeaction)+1;
            g[i].likes=h
            g[i].dislikes=y  
            record[0].likeaction=r
            likes.textContent=g[i].likes;
        }      
    }
    localStorage.setItem("Likes",JSON.stringify(g))
    localStorage.setItem("Active",JSON.stringify(record))
        }
        else{
            let thumbsUp = localStorage.getItem("Likes")
             if (thumbsUp==null){
            localStorage.setItem("Likes",JSON.stringify([{blogid:id,likes:"0",dislikes:"0"}]));
            thumbsUp=localStorage.getItem("Likes");
            }
            let g=JSON.parse(thumbsUp)
            const single=g.filter(blog=>blog.blogid==id)
            if(single.length==0){
                g.push({blogid:id,likes:"0",dislikes:"0"})
                console.log(g)
                localStorage.setItem("Likes",JSON.stringify(g));
            }
            for (let i = 0; i < g.length; i++) {
                if(g[i].blogid==id){
                    let j =parseInt(g[i].likes)-1
                    let u= parseInt(g[i].dislikes)
                    let t=parseInt(record[0].likeaction)-1;
                    g[i].likes=j
                    g[i].dislikes=u  
                    record[0].likeaction=t
                    likes.textContent=g[i].likes;
                }      
            }
            localStorage.setItem("Likes",JSON.stringify(g))
            localStorage.setItem("Active",JSON.stringify(record))
        }
        }
        else{
            console.log("you have liked first")
        }

    }
    else{
        loader.style.display="block";
        cancel.addEventListener('click',(e)=>{
            loader.style.display="none"
        })
    }

 }

//  incrementing dislikes
function funcDislike(){
    let action=localStorage.getItem("Active")
    if(action){
        const record=JSON.parse(action)
        if(record[0].likeaction==0){
            if(record[0].dislikeaction==0){
            let thumbsUp = localStorage.getItem("Likes")
    if (thumbsUp==null){
    localStorage.setItem("Likes",JSON.stringify([{blogid:id,likes:"0",dislikes:"0"}]));
    thumbsUp=localStorage.getItem("Likes");
    }
    let g=JSON.parse(thumbsUp)
    const single=g.filter(blog=>blog.blogid==id)
    if(single.length==0){
        g.push({blogid:id,likes:"0",dislikes:"0"})
        console.log(g)
        localStorage.setItem("Likes",JSON.stringify(g));
    }
    for (let i = 0; i < g.length; i++) {
        if(g[i].blogid==id){
            let h =parseInt(g[i].likes)
            let y= parseInt(g[i].dislikes)+1
            let r=parseInt(record[0].dislikeaction)+1;
            g[i].likes=h
            g[i].dislikes=y  
            record[0].dislikeaction=r
            dislikes.textContent=g[i].dislikes;
        }      
    }
    localStorage.setItem("Likes",JSON.stringify(g))
    localStorage.setItem("Active",JSON.stringify(record))
        }
        else{
            let thumbsUp = localStorage.getItem("Likes")
             if (thumbsUp==null){
            localStorage.setItem("Likes",JSON.stringify([{blogid:id,likes:"0",dislikes:"0"}]));
            thumbsUp=localStorage.getItem("Likes");
            }
            let g=JSON.parse(thumbsUp)
            const single=g.filter(blog=>blog.blogid==id)
            if(single.length==0){
                g.push({blogid:id,likes:"0",dislikes:"0"})
                console.log(g)
                localStorage.setItem("Likes",JSON.stringify(g));
            }
            for (let i = 0; i < g.length; i++) {
                if(g[i].blogid==id){
                    let j =parseInt(g[i].likes)
                    let u= parseInt(g[i].dislikes)-1
                    let t=parseInt(record[0].dislikeaction)-1;
                    g[i].likes=j
                    g[i].dislikes=u  
                    record[0].dislikeaction=t
                    dislikes.textContent=g[i].dislikes;
                }      
            }
            localStorage.setItem("Likes",JSON.stringify(g))
            localStorage.setItem("Active",JSON.stringify(record))
        }
        }
        else{
            console.log("you have liked first")
        }

    }
    else{
        loader.style.display="block";
        cancel.addEventListener('click',(e)=>{
            loader.style.display="none"
        })
    }

}

    </script>
</body>
</html>